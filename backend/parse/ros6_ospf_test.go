package parse

import (
	"encoding/base64"
	"encoding/json"
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestROS6OSPF(t *testing.T) {
	testcase := []struct {
		feterOutput string
		ospfData    string
	}{
		{
			feterOutput: "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",
			ospfData:    "[{\"area_id\":\"atomInner\",\"router\":[{\"router_id\":\"10.28.0.1\"},{\"router_id\":\"10.28.0.2\"},{\"router_id\":\"10.28.0.5\"},{\"router_id\":\"10.28.0.7\"},{\"router_id\":\"10.28.0.8\"}],\"links\":[{\"src\":\"10.28.0.1\",\"dst\":\"10.28.0.2\",\"cost\":1},{\"src\":\"10.28.0.1\",\"dst\":\"10.28.0.5\",\"cost\":1},{\"src\":\"10.28.0.1\",\"dst\":\"10.28.0.7\",\"cost\":1},{\"src\":\"10.28.0.2\",\"dst\":\"10.28.0.1\",\"cost\":20},{\"src\":\"10.28.0.2\",\"dst\":\"10.28.0.5\",\"cost\":20},{\"src\":\"10.28.0.5\",\"dst\":\"10.28.0.1\",\"cost\":1},{\"src\":\"10.28.0.5\",\"dst\":\"10.28.0.2\",\"cost\":1},{\"src\":\"10.28.0.5\",\"dst\":\"10.28.0.7\",\"cost\":1},{\"src\":\"10.28.0.5\",\"dst\":\"10.28.0.8\",\"cost\":1},{\"src\":\"10.28.0.7\",\"dst\":\"10.28.0.5\",\"cost\":10},{\"src\":\"10.28.0.7\",\"dst\":\"10.28.0.1\",\"cost\":10},{\"src\":\"10.28.0.7\",\"dst\":\"10.28.0.8\",\"cost\":10},{\"src\":\"10.28.0.8\",\"dst\":\"10.28.0.5\",\"cost\":1},{\"src\":\"10.28.0.8\",\"dst\":\"10.28.0.7\",\"cost\":1}]}]",
		},
	}

	for _, v := range testcase {
		gobOutput, err := base64.StdEncoding.DecodeString(v.feterOutput)
		asn := uint32(4242424242)
		p := ROS6OSPF{
			asn: asn,
		}
		p.Init(gobOutput)
		drawing := Drawing{
			OSPF: make(map[uint32]*OSPF),
		}
		err = p.ParseAndMerge(&drawing)
		assert.NoError(t, err)
		o := &OSPF{}
		err = json.Unmarshal([]byte(v.ospfData), o)
		assert.NoError(t, err)
	}

}
